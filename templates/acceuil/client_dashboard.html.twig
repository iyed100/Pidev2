{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* Styles globaux */
        .dashboard-container {
            margin-top: 80px;
            padding: 20px;
        }
        
        /* Navbar */
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Menu latéral */
        .nav-menu {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            height: 100%;
        }
        
        .nav-menu-item {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            color: #333;
            text-decoration: none;
        }
        
        .nav-menu-item:hover {
            background-color: #f8f9fa;
        }
        
        .nav-menu-item.active {
            background-color: #e9ecef;
            font-weight: bold;
        }
        
        .nav-menu-item i {
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }
        
        /* Cartes statistiques */
        .card-elegent {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: none;
        }
        
        .card-elegent:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .border-left-primary { border-left: 4px solid #4e73df !important; }
        .border-left-success { border-left: 4px solid #1cc88a !important; }
        .border-left-warning { border-left: 4px solid #f6c23e !important; }
        .border-left-info { border-left: 4px solid #36b9cc !important; }
        
        /* Section compte */
        .user-profile-section {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* Tableaux */
        .table-responsive {
            overflow-x: auto;
        }
    </style>
{% endblock %}

{% block body %}
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ path('app_acceuil') }}">
                <img src="{{ asset('images/logo.png') }}" width="50" height="50">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_acceuil') }}">Accueil</a>
                    </li>
                </ul>
                
                <span class="navbar-text text-white me-3">
                    Bonjour, {{ user.prenom }} {{ user.nom }}
                </span>
                <a href="{{ path('app_logout') }}" class="btn btn-outline-light">Déconnexion</a>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <div class="container-fluid dashboard-container">
        <div class="row">
            <!-- Menu latéral -->
            <div class="col-lg-3">
                <div class="nav-menu">
                    <h5 class="mb-4">Menu Client</h5>
                    
                    <a href="#" onclick="showSection('dashboard')" class="d-block nav-menu-item {{ app.request.get('section') != 'account' ? 'active' : '' }}">
                        <i class="fas fa-tachometer-alt"></i> Tableau de bord
                    </a>
                    
                    <div class="account-section my-3">
                        <h6 class="text-uppercase text-muted small fw-bold mb-2">Mon compte</h6>
                        <a href="#" onclick="showSection('account')" class="d-block nav-menu-item {{ app.request.get('section') == 'account' ? 'active' : '' }}">
                            <i class="fas fa-user-cog"></i> Paramètres du compte
                        </a>
                        <a href="#" class="d-block nav-menu-item">
                            <i class="fas fa-lock"></i> Sécurité
                        </a>
                        <a href="#" class="d-block nav-menu-item">
                            <i class="fas fa-bell"></i> Notifications
                        </a>
                    </div>
                    
                    <div class="services-section my-3">
                        <h6 class="text-uppercase text-muted small fw-bold mb-2">Services</h6>
                        <a href="#" class="d-block nav-menu-item">
                            <i class="fas fa-home"></i> Hébergement
                        </a>
                        <a href="#" class="d-block nav-menu-item">
                            <i class="fas fa-briefcase"></i> Coworking
                        </a>
                        <a href="#" class="d-block nav-menu-item">
                            <i class="fas fa-calendar-alt"></i> Événements
                        </a>
                        <a href="#" class="d-block nav-menu-item">
                            <i class="fas fa-comment-alt"></i> Avis/Réclamations
                        </a>
                    </div>
                    
                    <a href="{{ path('app_logout') }}" class="btn btn-danger w-100 mt-3">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </a>
                </div>
            </div>
            
            <!-- Contenu dynamique -->
            <div class="col-lg-9">
                <!-- Section Tableau de bord -->
                <div id="dashboard-section" style="display: {{ app.request.get('section') == 'account' ? 'none' : 'block' }}">
                    <!-- Cartes statistiques -->
                    <div class="row mb-4">
                        <!-- Réservations -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card-elegent card border-left-primary h-100 py-2">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="text-xs font-weight-bold text-primary mb-1">Réservations</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">5</div>
                                            <small class="text-success">2 en cours</small>
                                        </div>
                                        <i class="fas fa-calendar-check fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Événements -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card-elegent card border-left-success h-100 py-2">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="text-xs font-weight-bold text-success mb-1">Événements</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">3</div>
                                            <small class="text-success">1 participation</small>
                                        </div>
                                        <i class="fas fa-users fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Favoris -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card-elegent card border-left-warning h-100 py-2">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="text-xs font-weight-bold text-warning mb-1">Favoris</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">7</div>
                                            <small class="text-success">4 disponibles</small>
                                        </div>
                                        <i class="fas fa-heart fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dépenses -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card-elegent card border-left-info h-100 py-2">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class="text-xs font-weight-bold text-info mb-1">Dépenses</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">€1,850</div>
                                            <small class="text-success">15% économisé</small>
                                        </div>
                                        <i class="fas fa-euro-sign fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tableau des réservations -->
                    <div class="card-elegent card mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Mes Réservations récentes</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead class="bg-light">
                                        <tr>
                                            <th>Référence</th>
                                            <th>Hébergement</th>
                                            <th>Dates</th>
                                            <th>Prix</th>
                                            <th>Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>RES-2023-105</td>
                                            <td>Hôtel Premium, Paris</td>
                                            <td>15/10/2023 - 20/10/2023</td>
                                            <td>€750</td>
                                            <td><span class="badge bg-success">Confirmé</span></td>
                                        </tr>
                                        <tr>
                                            <td>RES-2023-106</td>
                                            <td>Appartement Business, Lyon</td>
                                            <td>05/11/2023 - 10/11/2023</td>
                                            <td>€420</td>
                                            <td><span class="badge bg-warning">En attente</span></td>
                                        </tr>
                                        <tr>
                                            <td>RES-2023-107</td>
                                            <td>Villa Luxe, Nice</td>
                                            <td>12/12/2023 - 19/12/2023</td>
                                            <td>€1,200</td>
                                            <td><span class="badge bg-success">Confirmé</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Événements à venir -->
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="card-elegent card shadow">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Mes Événements à venir</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex align-items-center">
                                            <img src="https://via.placeholder.com/40" class="rounded-circle me-3">
                                            <div>
                                                <h6 class="mb-0">Paris City Tour</h6>
                                                <small class="text-muted">15/10/2023 - 7 jours</small>
                                            </div>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <img src="https://via.placeholder.com/40" class="rounded-circle me-3">
                                            <div>
                                                <h6 class="mb-0">Gastronomic Week</h6>
                                                <small class="text-muted">22/11/2023 - 5 jours</small>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6 mb-4">
                            <div class="card-elegent card shadow">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Mes Favoris</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex align-items-center">
                                            <img src="https://via.placeholder.com/40" class="rounded-circle me-3">
                                            <div>
                                                <h6 class="mb-0">Hôtel Marina Bay</h6>
                                                <small class="text-muted">Singapour - €120/nuit</small>
                                            </div>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <img src="https://via.placeholder.com/40" class="rounded-circle me-3">
                                            <div>
                                                <h6 class="mb-0">Espace Coworking Central</h6>
                                                <small class="text-muted">Paris - €25/jour</small>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Section Mon compte -->
                <div id="account-section" style="display: {{ app.request.get('section') == 'account' ? 'block' : 'none' }}">
                    <section class="user-profile-section">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="mb-0">Gérer mon compte</h2>
                            <div class="d-flex">
                                <img src="https://ui-avatars.com/api/?name={{ user.prenom }}+{{ user.nom }}&size=80&background=6a11cb&color=fff" 
                                     class="rounded-circle me-3" alt="Avatar">
                            </div>
                        </div>
                        
                        <form method="POST" action="{{ path('app_update_user') }}" id="account-form">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="nom" class="form-label">Nom</label>
                                    <input type="text" class="form-control" id="nom" name="nom" value="{{ user.nom }}" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="prenom" class="form-label">Prénom</label>
                                    <input type="text" class="form-control" id="prenom" name="prenom" value="{{ user.prenom }}" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="age" class="form-label">Âge</label>
                                    <input type="number" class="form-control" id="age" name="age" value="{{ user.age }}" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="password" class="form-label">Nouveau mot de passe</label>
                                    <input type="password" class="form-control" id="password" name="password" placeholder="Laisser vide si inchangé">
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="confirm_password" class="form-label">Confirmer le mot de passe</label>
                                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirmez le nouveau mot de passe">
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newsletter" name="newsletter" checked>
                                        <label class="form-check-label" for="newsletter">
                                            Recevoir les newsletters et offres spéciales
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4 d-flex justify-content-between">
                                <button type="submit" class="btn btn-primary px-4">
                                    <i class="fas fa-save me-2"></i> Mettre à jour
                                </button>

                                <button type="submit" formaction="{{ path('app_delete_user') }}" 
                                        class="btn btn-outline-danger px-4"
                                        onclick="return confirmDelete()">
                                    <i class="fas fa-trash-alt me-2"></i> Supprimer mon compte
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-5 pt-4 border-top">
                            <h5 class="mb-3">Statistiques du compte</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card bg-light p-3">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="text-muted small">Membre depuis</h6>
                                                <p class="mb-0">{{ user.createdAt|date('d/m/Y') }}</p>
                                            </div>
                                            <i class="fas fa-calendar-alt text-muted"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light p-3">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="text-muted small">Dernière connexion</h6>
                                                <p class="mb-0">Aujourd'hui</p>
                                            </div>
                                            <i class="fas fa-clock text-muted"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light p-3">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="text-muted small">Statut</h6>
                                                <p class="mb-0">Compte vérifié</p>
                                            </div>
                                            <i class="fas fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function showSection(section) {
            event.preventDefault();
            
            // Masquer toutes les sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Afficher la section demandée
            document.getElementById(section + '-section').style.display = 'block';
            
            // Mettre à jour le menu actif
            document.querySelectorAll('.nav-menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Mettre à jour l'URL sans recharger la page
            history.pushState(null, null, '?section=' + section);
        }
        
        // Au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Ajuster la marge sous la navbar
            const navbarHeight = document.querySelector('.navbar').offsetHeight;
            document.querySelector('.dashboard-container').style.marginTop = navbarHeight + 'px';
            
            // Gérer l'état initial en fonction de l'URL
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');
            
            if (section === 'account') {
                showSection('account');
            }
            
            // Validation du formulaire
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirm_password').value;
                    
                    if (password && password !== confirmPassword) {
                        e.preventDefault();
                        alert('Les mots de passe ne correspondent pas');
                    }
                });
            }
        });
        // Dans votre block javascripts
function confirmDelete() {
    return confirm('Êtes-vous sûr de vouloir supprimer définitivement votre compte ? Cette action est irréversible.');
}

// Validation du formulaire avant soumission
document.getElementById('account-form').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password && password !== confirmPassword) {
        e.preventDefault();
        alert('Les mots de passe ne correspondent pas');
        return false;
    }
    return true;
});
    </script>
{% endblock %}